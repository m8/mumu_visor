.PHONY: all test clean

all: clean kvmsample test.bin

test.bin: entry.o main.o
	ld -m elf_i386 --oformat binary -N -e mystart -o main.bin -T linker.ld entry.o main.o

main.o:
	gcc -c -m16 -ffreestanding -fno-PIE -fno-lto -nostartfiles -nostdlib -o main.o -std=c99 main.c

entry.o: entry.S
	as -32 entry.S -o entry.o 

clean: 
	$(RM) *.o *.bin *.elf *.img
